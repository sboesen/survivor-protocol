<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Survivor Protocol v2.4</title>
</head>

<body>

    <div id="game-container">
        <div id="damage-layer"></div>

        <div id="ui-layer">
            <div class="xp-bar-container">
                <div id="xp-bar-fill"></div>
            </div>

            <!-- Weapon Slots (top left) -->
            <div id="weapon-slots" class="weapon-slots"></div>

            <div class="hud-top">
                <div>
                    <div><span id="hud-char">Knight</span> LVL <span id="hud-level">1</span></div>
                    <div style="margin-top:5px"><span id="hud-timer">00:00</span> <span style="color:#666">|</span>
                        Kills: <span id="hud-kills">0</span></div>
                    <div style="margin-top:2px;font-size:11px;color:#888">Particles: <span id="hud-particles">0</span>
                        <span style="color:#666">|</span> Enemies: <span id="hud-enemies">0</span></div>
                </div>
                <div class="hud-right">
                    <div class="hud-row">
                        <span id="hud-gold" style="color:var(--gold)">ðŸ’° 0</span>
                        <button class="loot-inv-btn" onclick="Game.toggleLootInventory()">LOOT [I]</button>
                    </div>
                    <div class="hud-row">
                        <span id="hud-veiled">Veiled: 0</span>
                        <button class="quit-btn" onclick="Game.quitRun()">ABORT</button>
                    </div>
                    <div id="hud-loot-summary" class="hud-loot-summary-row"></div>
                    <div id="debug-loot-indicator" class="debug-hud">DEBUG LOOT BOOST</div>
                </div>
            </div>

            <div class="extraction-ui">
                <div id="extract-warning" class="extract-warning" style="display:none;"></div>
                <div id="extract-countdown" class="extract-countdown" style="display:none;"></div>
                <div id="extract-progress" class="extract-progress" style="display:none;"></div>
                <div id="extract-arrow" class="extract-arrow" style="display:none;"></div>
            </div>

            <!-- Mobile Ultimate Button -->
            <div id="ult-btn" class="ult-btn" onclick="Game.triggerUlt()">
                âš¡
                <span class="btn-hotkey">Z</span>
                <div id="ult-cooldown-overlay" class="ult-cooldown" style="height:100%"></div>
            </div>

            <!-- Item Slots (bottom left) -->
            <div id="item-slots" class="item-slots">
                <div class="item-slot" data-item="pierce">
                    <span class="item-icon">ðŸ—¡</span>
                    <span class="item-count">0</span>
                </div>
                <div class="item-slot" data-item="projectile">
                    <span class="item-icon">ðŸ”®</span>
                    <span class="item-count">0</span>
                </div>
                <div class="item-slot" data-item="cooldown">
                    <span class="item-icon">âš¡</span>
                    <span class="item-count">0</span>
                </div>
                <div class="item-slot" data-item="scope">
                    <span class="item-icon">ðŸŽ¯</span>
                    <span class="item-count">0</span>
                </div>
                <div class="item-slot" data-item="damage">
                    <span class="item-icon">ðŸ’ª</span>
                    <span class="item-count">0</span>
                </div>
            </div>
        </div>

        <!-- Main Menu -->
        <div id="menu-screen" class="screen active">
            <img src="/logo.png" alt="Survivor Protocol" style="width: 560px; height: auto;">
            <h2 style="color:#aaa">v2.4: Pyromancer & Fireballs</h2>
            <div
                style="font-size:10px; color:#888; max-width:600px; margin:0 auto 10px; padding:10px; background:#222; border:1px solid #444; border-radius:4px;">
                <strong>ðŸ’Ž AUTO-SAFE SLOTS:</strong> When you die, your best items are automatically saved to stash.
                Upgrade to save more items on death! Priority: Legendary > Relic > Rare > Magic > Common. Same rarity:
                Random selection.
            </div>
            <div class="char-scroll" id="char-select-list"></div>
            <div style="margin-top:20px;">
                <button onclick="Game.start()" style="font-size:12px; padding:15px 30px;">START MISSION</button>
            </div>
            <div style="margin-top:10px;">
                <button onclick="Menu.openGacha()">SUMMON HERO (500G)</button>
                <button onclick="Menu.openShop()">ITEM UPGRADES</button>
                <button onclick="Menu.openStash()">STASH</button>
            </div>
            <button class="debug-btn-toggle" onclick="Menu.openDebug()">[ DEBUG MENU ]</button>
        </div>

        <!-- Debug Screen -->
        <div id="debug-screen" class="screen">
            <h1 style="color:var(--debug)">DEBUG TERMINAL</h1>
            <div class="debug-menu-content">
                <button class="debug-action-btn" onclick="Menu.openSpriteViewer()">SPRITE VIEWER</button>
                <button class="debug-action-btn" onclick="Debug.addGold(5000)">ADD 5000 GOLD</button>
                <button class="debug-action-btn" onclick="Debug.unlockAll()">UNLOCK ALL PILOTS</button>
                <button id="debug-loot-boost" class="debug-action-btn" onclick="Debug.toggleLootBoost()">LOOT BOOST:
                    OFF</button>
                <button class="debug-action-btn" onclick="Debug.freeShopRefresh()">FREE SHOP REFRESH</button>
                <button class="debug-action-btn" onclick="Debug.saveAllItems()">SAVE ALL ITEMS ON DEATH</button>
                <button class="debug-action-btn" onclick="Debug.resetProgress()" style="border-color: #f00;">WIPE ALL
                    DATA</button>
            </div>
            <button onclick="Menu.closeDebug()" style="margin-top:20px;">EXIT DEBUG</button>
        </div>

        <!-- Gacha Screen -->
        <div id="gacha-screen" class="screen">
            <h1 style="color:var(--rare)">NEURAL UPLINK</h1>
            <canvas id="gacha-canvas" width="200" height="200"></canvas>
            <div id="gacha-result">System Ready...</div>
            <div class="gacha-controls">
                <button id="pull-btn" onclick="GachaAnim.startPull()">SUMMON (500G)</button>
                <button id="gacha-back-btn" onclick="Menu.closeGacha()">RETURN</button>
            </div>
            <p style="margin-top:20px; font-size:10px; color:var(--gold)">Gold: <span id="gacha-gold">0</span></p>
        </div>

        <!-- Shop Screen -->
        <div id="shop-screen" class="screen">
            <h1>ARMORY</h1>
            <h2>Gold: <span id="shop-gold-display">0</span></h2>

            <div class="shop-tabs">
                <button class="shop-tab active" data-tab="upgrades">UPGRADES</button>
                <button class="shop-tab" data-tab="items">ITEMS</button>
                <button class="shop-tab" data-tab="gambler">GAMBLER</button>
            </div>

            <div id="upgrades-tab" class="shop-tab-content active">
                <div id="shop-grid" class="shop-grid"></div>
            </div>
            <div id="items-tab" class="shop-tab-content">
                <div id="shop-items-grid" class="shop-items-grid"></div>
            </div>
            <div id="gambler-tab" class="shop-tab-content">
                <div id="gambler-grid" class="shop-items-grid"></div>
            </div>

            <div class="shop-footer">
                <button onclick="Menu.manualRefreshShop()">REFRESH (200G)</button>
                <div class="shop-daily">Daily refresh: <span id="daily-timer">--</span></div>
            </div>

            <button onclick="Menu.closeShop()" style="margin-top:20px;">BACK</button>
        </div>

        <!-- Stash Screen -->
        <div id="stash-screen" class="screen stash-screen">
            <div class="stash-panel">
                <div class="stash-layout">
                    <div class="equipment-panel">
                        <h1>LOADOUT</h1>
                        <div class="loadout-stage">
                            <div class="loadout-silhouette" aria-hidden="true"></div>
                            <div id="loadout-grid" class="loadout-grid"></div>
                        </div>
                    </div>
                    <div class="inventory-panel">
                        <h2>STASH</h2>
                        <div id="stash-grid" class="stash-grid"></div>
                    </div>
                </div>
            </div>
            <div class="stash-footer">
                <button onclick="Menu.closeStash()">BACK</button>
                <div id="loadout-summary" class="loadout-summary">
                    <div class="summary-item summary-might">
                        <div class="summary-label">MIGHT</div>
                        <div class="summary-value" id="summary-might">+0%</div>
                    </div>
                    <div class="summary-item summary-cooldown">
                        <div class="summary-label">COOLDOWN</div>
                        <div class="summary-value" id="summary-cooldown">0%</div>
                    </div>
                    <div class="summary-item summary-area">
                        <div class="summary-label">AREA SIZE</div>
                        <div class="summary-value" id="summary-area">+0%</div>
                    </div>
                    <div class="summary-item summary-luck">
                        <div class="summary-label">LUCK</div>
                        <div class="summary-value" id="summary-luck">+0%</div>
                    </div>
                    <div class="summary-item summary-speed">
                        <div class="summary-label">SPEED</div>
                        <div class="summary-value" id="summary-speed">+0%</div>
                    </div>
                    <div class="summary-item summary-amount">
                        <div class="summary-label">PROJECTILES</div>
                        <div class="summary-value" id="summary-amount">+0</div>
                    </div>
                    <div class="summary-item summary-greed">
                        <div class="summary-label">GREED</div>
                        <div class="summary-value" id="summary-greed">+0%</div>
                    </div>
                    <div class="summary-item summary-armor">
                        <div class="summary-label">ARMOR</div>
                        <div class="summary-value" id="summary-armor">+0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sprite Viewer Screen -->
        <div id="sprite-viewer-screen" class="screen">
            <h1 style="color:var(--debug)">SPRITE VIEWER</h1>
            <p style="font-size:10px; color:#aaa;">All sprites rendered in-game style</p>
            <div id="sprite-viewer-container"
                style="position:relative; width:100%; height:60vh; background:#111; border:1px solid #333; margin:10px 0;">
                <canvas id="sprite-viewer-canvas"></canvas>
            </div>
            <button onclick="Menu.closeSpriteViewer()" style="margin-top:10px;">BACK</button>
        </div>

        <!-- Level Up Screen -->
        <div id="levelup-screen" class="screen">
            <h1>LEVEL UP!</h1>
            <p style="font-size:10px; color:#aaa; margin-bottom:20px;">Choose an upgrade</p>
            <div id="card-container"></div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameover-screen" class="screen">
            <h1 id="go-title" style="color: #ff3333;">KIA</h1>
            <div id="go-stats"
                style="margin-bottom: 20px; text-align: left; background: #222; padding: 20px; border: 1px solid #444;">
                <!-- Populated by JS -->
            </div>
            <button onclick="Game.returnToMenu()">EXTRACT</button>
        </div>

        <!-- Extraction Screen -->
        <div id="extract-screen" class="screen">
            <h1>EXTRACTION</h1>
            <p style="font-size:10px; color:#aaa; margin-bottom:10px;">Click reveal to unveil your haul.</p>
            <div id="extract-grid" class="extract-grid"></div>
            <div id="extract-confetti" class="extract-confetti"></div>
            <div style="display:flex; gap:12px; margin-top:16px;">
                <button id="extract-reveal-btn">REVEAL</button>
                <button id="extract-continue-btn">CONTINUE</button>
            </div>
        </div>

        <!-- Loot Inventory Screen -->
        <div id="loot-inventory-screen" class="screen">
            <h1>RUN LOOT</h1>
            <p
                style="color:#888; font-size:10px; margin-bottom:5px; background:#222; padding:8px; border-radius:4px; border:1px solid #444;">
                ðŸ’¡ <strong>Auto-Safe:</strong> Best items saved automatically on death. You cannot choose manually.
            </p>
            <p id="loot-secure-slot" style="color:#aaa; font-size:10px; margin-bottom:10px;">Auto-Safe Slots: 1/5</p>
            <div id="loot-inventory-grid" class="loot-inventory-grid"></div>
            <button onclick="Game.toggleLootInventory()">RESUME</button>
        </div>

        <div id="loadout-tooltip" class="loadout-tooltip"></div>
        <div id="extract-tooltip" class="extract-tooltip"></div>
        <div id="weapon-tooltip" class="weapon-tooltip"></div>
    </div>

    <script type="module" src="/src/main.ts"></script>
</body>

</html>